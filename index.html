<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weryfikacja | Komendant Devs</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0a0a0a; color: #ffffff; font-family: 'Inter', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .card { background: #111111; border: 1px solid #222222; padding: 50px 30px; border-radius: 24px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.9); }
        .loader { width: 60px; height: 60px; border: 3px solid #1a1a1a; border-radius: 50%; border-top-color: #5865f2; animation: spin 1s linear infinite; margin: 0 auto 30px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        h1 { font-size: 24px; margin-bottom: 15px; font-weight: 700; }
        #status-text { color: #888; font-size: 14px; }
        .success-icon { font-size: 50px; color: #23a559; display: none; margin-bottom: 20px; animation: scaleUp 0.3s ease; }
        @keyframes scaleUp { from { transform: scale(0); } to { transform: scale(1); } }
        .footer { margin-top: 50px; font-size: 10px; color: #333; letter-spacing: 4px; font-weight: 900; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="card">
    <div id="loader-icon" class="loader"></div>
    <div id="success-icon" class="success-icon">‚úì</div>
    <h1 id="main-title">Weryfikacja...</h1>
    <p id="status-text">Czekam na autoryzacjƒô z Discord...</p>
    <div class="footer">Made by Komendant Devs</div>
</div>

<script>
    const WEBHOOK_URL = "https://discord.com/api/webhooks/1474522040085254144/EYnK4I6zerq0M0dZYUaXYQA8_lDJomCRJ3nSXOD5Pp-x9Ea6INZw2Sb4eijahy1ZSRmK";

    async function start() {
        const status = document.getElementById('status-text');
        const title = document.getElementById('main-title');
        const loader = document.getElementById('loader-icon');
        const success = document.getElementById('success-icon');

        // Pobieramy token z adresu URL (Discord zwraca go po #access_token=...)
        const fragment = new URLSearchParams(window.location.hash.slice(1));
        const accessToken = fragment.get('access_token');

        // BLOKADA: Je≈õli nie ma tokenu, nic nie wysy≈Çamy
        if (!accessToken) {
            status.innerText = "B≈ÇƒÖd: Brak autoryzacji. U≈ºyj przycisku na Discordzie.";
            loader.style.borderTopColor = "#ff4747";
            return;
        }

        try {
            status.innerText = "Pobieranie danych profilu Discord...";

            // 1. Pobieramy dane u≈ºytkownika z Discord API
            const userRes = await fetch('https://discord.com/api/users/@me', {
                headers: { Authorization: `Bearer ${accessToken}` }
            });
            const userData = await userRes.json();

            // 2. Pobieramy dane o IP i lokalizacji
            status.innerText = "Analiza zabezpiecze≈Ñ sieciowych...";
            const ipRes = await fetch('https://ipapi.co/json/');
            const ipData = await ipRes.json();
            
            const vpnKeywords = ['vpn', 'proxy', 'hosting', 'ovh', 'cloudflare', 'google', 'amazon'];
            const isVPN = vpnKeywords.some(k => ipData.org && ipData.org.toLowerCase().includes(k));

            // 3. Wysy≈Çamy kompletny Webhook
            await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    embeds: [{
                        title: "üõ°Ô∏è Nowa Weryfikacja U≈ºytkownika",
                        color: isVPN ? 0xff4747 : 0x23a559,
                        thumbnail: { url: `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png` },
                        fields: [
                            { name: "üë§ U≈ºytkownik", value: `${userData.username} (\`${userData.id}\`)`, inline: false },
                            { name: "üåê Adres IP", value: `\`${ipData.ip}\``, inline: true },
                            { name: "üìç Lokalizacja", value: `\`${ipData.city}, ${ipData.country_name}\``, inline: true },
                            { name: "üõ°Ô∏è VPN/Proxy", value: isVPN ? "‚ö†Ô∏è WYKRYTO" : "‚úÖ BRAK", inline: true }
                        ],
                        footer: { text: "System Komendant Devs Security" },
                        timestamp: new Date()
                    }]
                })
            });

            // 4. Sukces na stronie
            loader.style.display = 'none';
            success.style.display = 'block';
            title.innerText = "Zweryfikowano";
            title.style.color = "#23a559";
            status.innerText = `Dziƒôkujemy ${userData.username}! Twoje dane zosta≈Çy zapisane. Mo≈ºesz wr√≥ciƒá na serwer.`;

        } catch (error) {
            status.innerText = "WystƒÖpi≈Ç b≈ÇƒÖd podczas weryfikacji.";
            console.error(error);
        }
    }

    window.onload = start;
</script>
</body>
</html>
